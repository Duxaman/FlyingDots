<!doctype html>
<html>

<head>
    <meta charset="utf8">
    <link rel="stylesheet" href="style.css">
    <title>Flying Dots - Game</title>
</head>

<body onload="ShowSettings()">
    <div id="workplace">
        <!-- Bodies format example
        <div class="Body Ship Player" style="top: 50px; left:100px; width: 30px; height: 30px;">
            <p>Test Name</p>
        </div>
        <div class="Body Ship Enemy" style="top: 80px; left:300px; width: 50px; height: 50px;">
            <p>Name</p>
        </div>
        <div class="Body Star" style="top: 130px; left:100px; width: 100px; height: 100px;"></div>
        <div class="Body Asteroid" style="top: 400px; left:100px; width: 150px; height: 150px;"></div>
        <div class="Body LiteWeaponShell" style="top: 450px; left:100px; width: 2px; height: 2px;"></div>
        <div class="Body FireWeaponShell" style="top: 470px; left:100px; width: 4px; height: 4px;"></div>
        <div class="Body BibaWeaponShell" style="top: 490px; left:100px; width: 20px; height: 20px;"></div>
        <div class="Body HealBuffItem" style="top: 520px; left:100px; width: 30px; height: 30px;"></div>
        <div class="Body LiteWeaponUI" style="top: 580px; left:100px; width: 30px; height: 30px;"></div>
        <div class="Body FireWeaponUI" style="top: 640px; left:100px; width: 30px; height: 30px;"></div>
        <div class="Body BibaWeaponUI" style="top: 680px; left:100px; width: 30px; height: 30px;"></div>
        <div class="Body HealBuffItemUI" style="top: 700px; left:100px; width: 30px; height: 30px;"></div>
    -->
    </div>
    <div id="dashboard" class="box">
        <span>ðŸ’›</span>
        <div id="healthbox">
            <div id="healthplaceholder">
                <div id="healthbar"></div>
            </div>
            </span>
        </div>
        <span id="hp">0</span>
    </div>
    <div id="inventory" class="box">
        <table id="invtable">
            <tr>
                <td id="inv1">0</td>
                <td id="inv2">0</td>
                <td id="inv3">0</td>
                <td id="inv4">0</td>
            </tr>
        </table>
    </div>
    <div id="scorebox" class="box">
        0
    </div>
    <div id="time" class="box">
        00:00
    </div>
    <ul id="pausemenu" class="menu">
        <li onclick="ToogleGamePause()">Resume</li>
        <li onclick="StopGame()">Quit</li>
    </ul>
    <div class="settings">
        Difficulty:
        <select>
            <option value=" 0">Easy</option>
            <option selected value="1">Medium</option>
            <option value="2">Hard</option>
            <option value="3">Nuts</option>
        </select><br><br>
        Name:
        <input type="text" id="name">
        <div>
            <input type="button" value="Launch Game" onclick="StartGame()">
            <input type="button" value="Cancel" onclick="window.location = 'main.html'">
        </div>
    </div>
    <script>
        var GameObj;
        var Timer;
        var TimerState;
        var ScoreBox;
        var TimeBox;
        var HpBox;
        var InvBox;
        var SelectedInvInd;

        function SelectItemUi(ind) {
            InvBox[SelectedInvInd].style.removeProperty('border-color') //unselect previous item in ui
            SelectedInvInd = ind;
            InvBox[SelectedInvInd].style.borderColor = "yellow"; //select new item
        }

        function HandleInput(event) {
            switch (event.key) {
                case "Escape": ToogleGamePause();
                    break;
                case '1':
                    SelectItemUi(1);
                    break;
                case '2':
                    SelectItemUi(2);
                    break;
                case '3':
                    SelectItemUi(3);
                    break;
                case '4':
                    SelectItemUi(4);
                    break;
                default:
                    break; //player movements are handled in game obj
            }
        }

        function ShowSettings() {
            document.getElementsByClassName('settings')[0].style.display = 'block';
        }

        function StartGame() {
            let name = document.getElementById('name').value;
            let diffvalue = document.getElementsByTagName('select')[0].value;
            if (name !== '') {
                let size = new Point(Window.innerWidth, Window.innerHeight);
                document.getElementsByClassName('settings')[0].style.display = 'none';
                ScoreBox = document.getElementById('score');
                TimeBox = document.getElementById('time');
                HpBox = document.getElementById('hp');
                InvBox = [];
                for (i = 1; i <= 4; ++i) {
                    InvBox.push(document.getElementById('inv' + i));
                }
                GameObj = new Game(Window, size, OnGameOver, name, diffvalue);
                GameObj.Start();
                Window.addEventListener('keydown', HandleInput);
                TimerState = true;
                Timer = setInterval(UpdateUI, 1000);
            }
            else alert(" You need to enter your name first!");
        }

        function StopGame() {
            GameObj.Stop();
        }

        function ToogleGamePause() {
            if (TimerState) {
                clearTimeout(Timer);
                GameObj.Pause();
                document.getElementById('pausemenu').style.display = 'block';
            }
            else {
                document.getElementById('pausemenu').style.display = 'none';
                GameObj.Start();
                Timer = setInterval(UpdateUI, 500);
            }
            TimerState = !TimerState;
        }

        function UpdateUI() {
            TimeBox.InnerText = GameObj.GetTime();
            ScoreBox.InnerText = GameObj.GetScore();
            HpBox.InnerText = GameObj.GetPlayerStat();
            UpdateInventory();
        }

        function UpdateInventory() {
            let inv = GameObj.GetPlayerStat();
            for (i = 0; i < inv.Length; ++i) {
                InvBox[i].setAttribute('class', inv[i][0]);
                InvBox[i].InnerText = inv[i][1];
            }
            if (SelectedInvInd !== undefined) {
                if (SelectedInvInd >= inv.Length - 1) //if item has been removed
                {
                    InvBox[SelectedInvInd].style.removeProperty('border-color') //unselect previous item in ui
                    SelectedInvInd = inv.Length - 1;
                    InvBox[SelectedInvInd].style.borderColor = "yellow"; //select new item
                }
            }
        }

        function OnGameOver(PlayerName, SavedTime, Score) {
            Window.removeEventListener('keydown', HandleInput);
            clearTimeout(Timer);
            //save result
            //redirect to leaderboards page
        }

    </script>
    <script src="js/Constants.js"></script>
    <script src="js/GameObjects.js"></script>
    <script src="js/Inventory.js"></script>
    <script src="js/Map.js"></script>
    <script src="js/MapGenerator.js"></script>
    <script src="js/Spawner.js"></script>
    <script src="js/CollisionCalculator.js"></script>
    <script src="js/Game.js"></script>
</body>

</html>